# 模型超参数配置文档

本文档记录了 YOLOv5-Face 检测模型与 DeepSort 追踪算法的核心超参数及其调优建议。

## 1. YOLOv5 检测参数 (`cfg`)

控制人脸检测的灵敏度和准确度。

| 参数名 | 默认值 | 说明 | 调优建议 |
| :--- | :--- | :--- | :--- |
| **`conf_thres`** | `0.4` | **置信度阈值**<br>决定模型"多确信"才算检测到人脸。 | • **漏检严重时**：调低至 `0.25` - `0.3`。<br>• **误检严重时**（背景被识别为人脸）：调高至 `0.5`。 |
| **`iou_thres`** | `0.5` | **NMS IOU 阈值**<br>用于去除重叠的检测框。 | • 通常保持 `0.45` - `0.5` 即可。<br>• 如果人脸非常密集且重叠严重，可稍微调高。 |
| **`input_shape`** | `[640, 640]` | **输入尺寸** | 保持默认，需与模型转换时的 shape 一致。 |

---

## 2. DeepSort 追踪参数

控制 ID 的稳定性、抗遮挡能力和运动匹配。

| 参数名 | 默认值 | 说明 | 调优建议 |
| :--- | :--- | :--- | :--- |
| **`max_dist`** | `0.2` | **特征匹配阈值** (0.0-1.0)<br>判断两个人脸特征是否属于同一人的严格程度。 | • **ID 频繁跳变时**：由于使用行人模型(Mars)做人脸，特征匹配可能不完美，建议**调高至 `0.3` 或 `0.4`** 以放宽匹配条件，使 ID 更稳定。 |
| **`min_confidence`** | `0.3` | **追踪置信度阈值**<br>低于此分数的检测框不参与追踪。 | • 建议与 YOLO 的 `conf_thres` 保持一致或略低。 |
| **`max_iou_distance`** | `0.7` | **运动匹配阈值**<br>基于位置重叠度判断是否为同一目标。 | • **快速移动跟丢时**：如果目标移动快或帧率低，框跑得远，建议**调高至 `0.8` 或 `0.9`**。 |
| **`max_age`** | `70` | **最大保留帧数**<br>目标消失后，ID 保留多久（70帧约2-3秒）。 | • **遮挡后 ID 变了**：调高至 `100+`。<br>• **出现幽灵框**（人走了框还在）：调低至 `30`。 |
| **`n_init`** | `3` | **确认帧数**<br>目标连续出现多少帧才分配正式 ID。 | • **出现一闪而过的错误框**：建议**调高至 `5` 或 `10`**，过滤掉不稳定的瞬时误检。 |
| `nms_max_overlap` | `0.5` | DeepSort 内部 NMS 阈值 | 通常保持默认。 |
| `nn_budget` | `100` | 特征库大小 | 保留最近 100 帧的特征用于匹配。 |

---

## 3. 常见问题调优速查表

| 现象 | 调整方案 |
| :--- | :--- |
| **人脸检测不到** | 📉 降低 `conf_thres` (如 0.25) |
| **把背景看成人脸** | 📈 提高 `conf_thres` (如 0.5) |
| **同一个人的 ID 变来变去 (1->2->3)** | 📈 提高 `max_dist` (如 0.4) |
| **人脸快速移动时 ID 丢失** | 📈 提高 `max_iou_distance` (如 0.9) |
| **人脸被遮挡一会，再出现 ID 变了** | 📈 提高 `max_age` (如 100) |
| **人脸已经离开画面，框还残留几秒** | 📉 降低 `max_age` (如 30) |
| **画面中偶尔闪烁出现错误的框** | 📈 提高 `n_init` (如 5) |